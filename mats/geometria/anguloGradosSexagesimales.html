<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta https-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://pe-pe-pe.herokuapp.com/public/resources/libraries/vue.global.js"></script>

    <script
        src="https://pe-pe-pe.herokuapp.com/public/atlasConocimiento/nodosConocimiento/recursos/components/bloque.js"></script>
    <script
        src="https://pe-pe-pe.herokuapp.com/public/atlasConocimiento/nodosConocimiento/recursos/components/enlace.js"></script>
    <script
        src="https://pe-pe-pe.herokuapp.com/public/atlasConocimiento/nodosConocimiento/recursos/components/recuadro.js"></script>


    <link rel="stylesheet" href="estilosComponenteFlechaVector.css">
    <link rel="stylesheet" href="componenteReglaEstilo.css">
    <link rel="stylesheet"
        href="https://pe-pe-pe.herokuapp.com/public/atlasConocimiento/nodosConocimiento/recursos/estilos/estilosGenerales.css">
    <link rel="stylesheet"
        href="https://pe-pe-pe.herokuapp.com/public/atlasConocimiento/nodosConocimiento/recursos/components/recuadroEstilo.css">
    <link rel="stylesheet"
        href="https://pe-pe-pe.herokuapp.com/public/atlasConocimiento/nodosConocimiento/recursos/components/bloqueEstilo.css">
    <link rel="stylesheet"
        href="https://pe-pe-pe.herokuapp.com/public/atlasConocimiento/nodosConocimiento/recursos/components/enlaceEstilo.css">



    <title>Angulo - grados sexagesimales.</title>
</head>

<body>
    <div id="doc">
        <p>
            El ángulo más amplio que se puede formar entre dos líneas traza una circunferencia completa
        </p>


        <bloque-component tipo="ejemplo">
            <template #cabecera>
                En este cuadro se muestra la máxima apertura posible.
            </template>

            <div class="flexVertical">
                <div class="zonaInteraccion" id="zonaInteraccion1">
                    <div class="linea h1Linea" id="linea1">
                    </div>
                    <div class="linea h1Linea" id="linea2" :style="[estiloLinea2]">
                    </div>
                    <canvas id="herramienta1Canvas" ref="herramienta1Canvas" width=200 height=200>

                    </canvas>
                    <transition name="fade">
                        <recuadro-component tipo="datoNuevo" v-show="rotacionLinea2>=360"
                            id="herramienta1CartelMaximaApertura">
                            Ángulo máximo
                        </recuadro-component>
                    </transition>
                </div>
                <recuadro-component tipo="instruccionTeclado">
                    <div class="flexVertical">
                        <div>
                            Mueve el control para aumentar el ángulo
                        </div>
                        <input type="range" min="0" max="360" v-model="rotacionLinea2" style="width: min(80%, 280px)">

                    </div>
                </recuadro-component>
            </div>
        </bloque-component>

        <p>
            Por motivos históricos, el ángulo más abierto posible fue subdividido en 360 fracciones. Estas fracciones se
            llaman <span class="resaltado">grados sexagesimales</span>.
        </p>

        <bloque-component tipo="herramientaInteractiva" @desplegado="iniciarHerramienta2">
            <template #cabecera>
                En este cuadro se pueden ver los grados sexagesimales.
            </template>
            <recuadro-component tipo="instruccionTeclado">
                Mueve el puntero por la figura para cambiar el ángulo.
            </recuadro-component>
            <div class="zonaInteraccion" id="zonaInteraccion2">
                <div id="representacionVueltaCompleta">
                    <div class="circulo">
                        <div class="linea" id="herramienta2LineaBase">

                        </div>
                        <div class="divisionSexagesimal" v-for="num of 360"
                            :class="{tocada:herramienta2LabelMostrada===num}"
                            :style="[{transform: 'rotate('+(1-num)+'deg)'}]" @mouseenter="herramienta2LabelMostrada=num"
                            @touchmove="herramienta2LabelMostrada=num">
                            <div class="parteVisible" style="width: 100%">

                            </div>
                            <div class="labelDivision" :style="[{transform: 'rotate('+(num-1)+'deg)'}]"
                                v-show="herramienta2LabelMostrada===num">
                                {{num-1}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </bloque-component>


        <recuadro-component tipo="datoPrevio">
            Cualquier ángulo puede ser medido según cuantos grados sexagesimales caben en él.
        </recuadro-component>

        <bloque-component tipo="herramientaInteractiva">
            <template #cabecera>
                En este cuadro se puede medir ángulos en grados sexagesimales.
            </template>


            <div class="zonaInteraccion" ref="herramienta3ZonaInteraccion" id="herramienta3ZonaInteraccion"
                @mouseup.left="ungrabHerramienta3" @pointerleave="ungrabHerramienta3"
                @pointermove="herramienta3MoverLinea" @touchend="ungrabHerramienta3">
                <div class="circulo" ref="herramienta3Circulo" id="herramienta3Circulo">
                    <div class="divisionSexagesimal" v-for="num of 360"
                        :class="{tocada: (num>h3DireccionLinea1 && num<=h3DireccionLinea2) || (h3DireccionLinea2>360 && num>=0 && num<=h3DireccionLinea2-360)}"
                        :style="[{transform: 'rotate('+(1-num)+'deg)'}]">
                        <div class="parteVisible">
                        </div>
                        <div class="labelDivision" :style="[{transform: 'rotate('+(num-1)+'deg) translateY(-50%)'}]"
                            v-show="Math.round((h3DireccionLinea1 + h3GradosApertura/2)%360)===num">
                            {{h3GradosApertura}}
                        </div>
                    </div>
                    <div class="linea lineaAgarrable" id="lineaAgarrable1"
                        :style="[{transform: 'rotate('+herramienta3DireccionLinea1+'rad)'}]">
                        <div class="handler" @mousedown.left.stop="herramienta3GrabbedLinea1=true"
                            @touchstart.stop.prevent="herramienta3GrabbedLinea1=true"> </div>
                    </div>
                    <div class="linea lineaAgarrable" id="lineaAgarrable2"
                        :style="[{transform: 'rotate('+herramienta3DireccionLinea2+'rad)'}]">
                        <div class="handler" @mousedown.left.stop="herramienta3GrabbedLinea2=true"
                            @touchstart.stop.prevent="herramienta3GrabbedLinea2=true"> </div>
                    </div>
                </div>
            </div>
        </bloque-component>

        <recuadro-component tipo="datoPrevio">
            Los grados sexagesimales son marcados con el símbolo <span class="resaltado">°</span>; 90 grados
            sexagesimales se escribe: <span class="resaltado">90°</span>
        </recuadro-component>
    </div>
</body>

</html>

<script type="module">
    function degToRad(deg) {
        return deg * Math.PI / 180

    }

    const {ref, computed, nextTick, watch} = Vue;
    const {createApp} = Vue;
    createApp({
        setup() {
            const rotacionLinea2 = ref(0);
            const estiloLinea2 = computed(() => {
                return {
                    transform: `rotate(${-rotacionLinea2.value}deg)`,
                }
            })
            const herramienta1Canvas = ref(null);
            function herramienta1TrazarArco() {
                if (!herramienta1Canvas.value) {
                    console.log(`No hay canvas`);
                    return;
                }
                console.log(`Trazando arco`);
                const lapiz = herramienta1Canvas.value.getContext("2d");
                lapiz.lineWidth = 3;
                lapiz.strokeStyle = "#26547c";
                lapiz.clearRect(0, 0, 200, 200);
                lapiz.beginPath();
                lapiz.arc(100, 100, 55, 0, -degToRad(rotacionLinea2.value), true);
                lapiz.stroke();
            }
            watch(rotacionLinea2, () => {
                herramienta1TrazarArco();
            })

            const elementoCanvas = ref(null);
            async function iniciarHerramienta2() {
                await nextTick();
                console.log("Pintando canvas 2");
                if (!elementoCanvas.value) {
                    console.log(`No hay canvas`);
                    return;
                }
                const canvas = elementoCanvas.value;
                const lapiz = canvas.getContext('2d');

                lapiz.beginPath();
                lapiz.arc(100, 100, 50, 0, 45);
                lapiz.stroke();
            }
            const herramienta2LabelMostrada = ref(null);

            const herramienta3ZonaInteraccion = ref(null);
            const herramienta3Circulo = ref(null);
            const herramienta3GrabbedLinea1 = ref(false);
            const herramienta3GrabbedLinea2 = ref(false);
            const herramienta3DireccionLinea1 = ref(0);
            const herramienta3DireccionLinea2 = ref(-Math.PI / 2);
            const h3DireccionLinea1 = computed(() => {
                let deg = (herramienta3DireccionLinea1.value * 180 / Math.PI) % 360;
                if (deg <= 0) {
                    deg += 360;
                }
                return parseInt(360 - deg);
            });
            const h3DireccionLinea2 = computed(() => {
                let deg = (herramienta3DireccionLinea2.value * 180 / Math.PI) % 360;
                if (deg <= 0) {
                    deg += 360;
                }
                deg = (360 - deg);
                if (h3DireccionLinea1.value > deg) {
                    deg += 360;
                }
                return parseInt(deg);
            });
            const h3GradosApertura = computed(() => {
                return h3DireccionLinea2.value - h3DireccionLinea1.value;
            })
            function ungrabHerramienta3() {
                herramienta3GrabbedLinea1.value = false;
                herramienta3GrabbedLinea2.value = false;
            }
            const h3UltimoMovimientoLinea = ref(Date.now());
            const umbralMovimientoLinea = 50;
            function herramienta3MoverLinea(evento) {
                if (!herramienta3GrabbedLinea1.value && !herramienta3GrabbedLinea2.value) {
                    return
                }
                if (!herramienta3Circulo.value) {
                    console.log(`No hay círculo`);
                    return;
                }
                if (Date.now() - h3UltimoMovimientoLinea.value < umbralMovimientoLinea) {
                    return;
                }
                console.log("Moviendo línea");
                const offsetCirculo = herramienta3Circulo.value.getBoundingClientRect();
                const centroCirculo = {
                    x: offsetCirculo.left + offsetCirculo.width / 2,
                    y: offsetCirculo.top + offsetCirculo.height / 2,
                }
                let vector = {
                    x: evento.clientX - centroCirculo.x,
                    y: evento.clientY - centroCirculo.y,
                }
                let direccion = Math.atan2(vector.y, vector.x);
                if (herramienta3GrabbedLinea1.value) {
                    herramienta3DireccionLinea1.value = direccion;
                }
                if (herramienta3GrabbedLinea2.value) {
                    herramienta3DireccionLinea2.value = direccion;
                }
                h3UltimoMovimientoLinea.value = Date.now();
            }

            return {
                estiloLinea2, rotacionLinea2, herramienta1Canvas, herramienta1TrazarArco, elementoCanvas, iniciarHerramienta2, herramienta2LabelMostrada,
                herramienta3ZonaInteraccion, herramienta3Circulo, herramienta3GrabbedLinea1, herramienta3GrabbedLinea2, herramienta3DireccionLinea1, h3DireccionLinea1, h3GradosApertura, herramienta3DireccionLinea2, h3DireccionLinea2, ungrabHerramienta3, herramienta3MoverLinea,
                h3UltimoMovimientoLinea,
            }

        },
        components: {
            recuadroComponent,
            bloqueComponent,
            enlaceComponent,
        },
        data() {
            return {
            }
        },
        methods: {
        }
    }).mount("#doc");
</script>

<style>
    .linea {
        height: 2px;
        width: 200px;
        background-color: var(--paletaPrevio);
        transform-origin: center left;
        position: absolute;
        top: 50%;
        left: 50%;
    }

    .h1Linea {
        width: min(200px, 30vw);
    }

    #zonaInteraccion1 {
        height: 500px;
        width: 100%;
    }

    #herramienta1Canvas {
        width: 100px;
        height: 100px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    #herramienta1CartelMaximaApertura {
        position: absolute;
        z-index: 2;
        left: 50%;
        top: 50%;
        transform: translate(-50%, 100px);
    }

    #zonaInteraccion2 {
        position: relative;
    }

    #canvasGradosSezagesimales {
        width: 200px;
        height: 200px;
        margin: 0px auto;
        border: 1px solid black;
    }


    .circulo {
        width: min(300px, 50vw);
        height: min(300px, 50vw);
        border-radius: 50%;
        border: 4px solid var(--paletaPrevio);
        position: relative;
        box-sizing: border-box;
        margin: 10px auto;
    }

    .circulo .divisionSexagesimal {
        width: 53%;
        height: 1px;
        transform-origin: 0px center;
        position: absolute;
        top: 50%;
        left: 50%;
    }

    .circulo .divisionSexagesimal.tocada {
        z-index: 1;
    }

    .circulo .divisionSexagesimal.tocada .parteVisible {
        background-color: var(--paletaActual);
    }

    .circulo .divisionSexagesimal .parteVisible {
        height: 100%;
        width: 50%;
        position: absolute;
        top: 0px;
        background-color: #DEDEDE;
        right: 0px;
    }

    .circulo .divisionSexagesimal .labelDivision {
        position: absolute;
        left: calc(100% + 10px);
        top: 50%;
        background-color: var(--paletaPrevio);
        padding: 3px 3px;
        transform-origin: center;
    }

    #herramienta2LineaBase {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(0px, -1px);
        height: 2px;
        width: calc(50% + 20px);
        z-index: 2;
        pointer-events: none;
    }

    #herramienta3ZonaInteraccion {
        min-height: 500px;
    }

    #herramienta3Circulo {
        margin-top: 100px;
    }

    #herramienta3Circulo .divisionSexagesimal .parteVisible {
        width: 6%;
    }

    #herramienta3Circulo .divisionSexagesimal .labelDivision {
        background-color: var(--paletaActual);
        color: whitesmoke;
    }

    .lineaAgarrable {
        position: absolute;
        top: 50%;
        left: 50%;
        user-select: none;
        width: 65%;
    }

    .lineaAgarrable .handler {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: var(--paletaMain);
        position: absolute;
        left: 100%;
        transform: translate(-50%, -50%);
        cursor: pointer;
    }

    #lineaAgarrable2 {
        transform: rotate(1rad);
    }
</style>
